---
title: Building a dockerized shiny server with packaged shiny apps and deploy it publicly in 2 minutes
author: Thomas Goossens
date: '2018-08-01'
draft: true
categories:
  - r
  - docker
  - linux
  - shiny
tags:
  - how-to
  - internet
---



<div id="write-your-shiny-app-as-a-package" class="section level1">
<h1>Write your shiny App as a package</h1>
<p>Building shiny apps as package will help you to produce a cleaner and easier to maintain code thanks to devtools and testthat. <a href="https://wlandau.github.io/2016/11/01/appPackage/" class="uri">https://wlandau.github.io/2016/11/01/appPackage/</a>. I heavily recommand you to code your app in this way. Doing so will also allow you to use <code>devtools::install_github()</code> to quickly install your app on any computer/server. R packages are the most efficient way to make reproductible science. <a href="https://kbroman.org/pkg_primer/pages/why.html">Why ?</a></p>
<p>To know how to code your shiny app as a package, <a href="https://stackoverflow.com/questions/37830819/developing-shiny-app-as-a-package-and-deploying-it-to-shiny-server">this</a> stackoveflow thread is an excellent starting point.</p>
</div>
<div id="create-a-shiny-server-docker-image-which-contains-the-packaged-shiny-apps" class="section level1">
<h1>Create a shiny server docker image which contains the packaged shiny app(s)</h1>
<p>A <a href="https://shiny.rstudio.com/articles/shiny-server.html">shiny server</a> allows you to distribute mulitples shiny apps over the internet at their own URL in an easy and efficient way. Setting up a shiny server may be time consuming but thanks to Docker and the rocker-org community, you can now quickly set up your own shiny server ! To do so, simply clone the rocker-org shiny server <a href="https://github.com/tocker-org/shiny-1">repo</a> :</p>
<pre class="bash"><code>$ git clone git@github.com:rocker-org/shiny.git</code></pre>
<p>Open the Dockerfile (which is the recipe to create the Docker image that will be used to instantiate the shiny server) and add the instruction to install your packaged shinyApp. If your app is pushed to a github repository, you can paste this line to â€¦</p>
<p><code>RUN R -e &quot;devtools::install_github('&lt;USERNAME&gt;/&lt;REPONAME&gt;', ref='&lt;BRANCHNAME&gt;', force=TRUE)&quot;</code></p>
<p>Repeat this step for every packaged shiny app you want to be accessible through your server.</p>
<p>Now you can push your modified Docker file to github.</p>
</div>
<div id="make-your-docker-shiny-server-image-accessible-through-docker-hub" class="section level1">
<h1>Make your docker shiny server image accessible through docker hub</h1>
<p>To do so, you will need to link your github and dockerhub accounts. To do so, simply follow the instructions provided in <a href="https://felixcentmerino.wordpress.com/containers/sync-up-docker-hub-and-github-to-build-images-automatically/">this post</a></p>
</div>
<div id="installing-the-docker-shiny-server-image-on-a-server" class="section level1">
<h1>installing the docker shiny server image on a server</h1>
<p>Once docker hub shows that the build is ready, on the host server enter the folowing command :</p>
<pre class="bash"><code>$ sudo docker pull &lt;USERNAME/IMAGENAME&gt;</code></pre>
<p>The shiny server image is now available in your server. But we need one more step ! As the shinyapps are only available as packages, we need some extra lines of R code to actually initiate the shiny apps. On the host server, create a folder which contains your R scripts that instantiate the shiny app. Example R script :</p>
<pre class="r"><code>dir &lt;- system.file(&quot;shiny&quot;, &quot;reporting&quot;, package = &quot;defHydWal&quot;)
setwd(dir)
shiny::shinyAppDir(&quot;.&quot;)</code></pre>
</div>
<div id="instantiate-at-an-open-port-in-detached-mode" class="section level1">
<h1>instantiate at an open port in detached mode</h1>
<pre class="bash"><code>sudo docker run -d --rm -p 3838:3838     -v /home/tgoossens/Documents/code/agrometeor/shiny-1/mountpoints/:/srv/shiny-server/     -v /srv/shinylog/:/var/log/shiny-server/     pokyah/shinyagro</code></pre>
<p>for mounting the token : <a href="https://stackoverflow.com/questions/18861834/mounting-multiple-volumes-on-a-docker-container" class="uri">https://stackoverflow.com/questions/18861834/mounting-multiple-volumes-on-a-docker-container</a></p>
</div>
