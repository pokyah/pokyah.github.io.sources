---
title: Building a dockerized shiny server with packaged shiny apps and deploy it publicly in 2 minutes
author: Thomas Goossens
date: '2018-08-01'
draft: true
categories:
  - r
  - docker
  - linux
  - shiny
tags:
  - how-to
  - internet
---

# Write your shiny App as a package

Building shiny apps as package will help you to produce a cleaner and easier to maintain code thanks to devtools and testthat. https://wlandau.github.io/2016/11/01/appPackage/. I heavily recommand you to code your app in this way. Doing so will also allow you to use `devtools::install_github()` to quickly install your app on any computer/server.
R packages are the most efficient way to make reproductible science. [Why ?](https://kbroman.org/pkg_primer/pages/why.html)

To know how to code your shiny app as a package, [this](https://stackoverflow.com/questions/37830819/developing-shiny-app-as-a-package-and-deploying-it-to-shiny-server) stackoveflow thread is an excellent starting point.

# Create a shiny server docker image which contains the packaged shiny app(s)

A [shiny server](https://shiny.rstudio.com/articles/shiny-server.html) allows you to distribute mulitples shiny apps over the internet at their own URL in an easy and efficient way. Setting up a shiny server may be time consuming but thanks to Docker and the rocker-org community, you can now quickly set up your own shiny server ! To do so, simply clone the rocker-org shiny server [repo](https://github.com/tocker-org/shiny-1) :

```bash
$ git clone git@github.com:rocker-org/shiny.git
```

Open the Dockerfile (which is the recipe to create the Docker image that will be used to instantiate the shiny server) and add the instruction to install your packaged shinyApp.
If your app is pushed to a github repository, you can paste this line to ... 

`RUN R -e "devtools::install_github('<USERNAME>/<REPONAME>', ref='<BRANCHNAME>', force=TRUE)"`

Repeat this step for every packaged shiny app you want to be accessible through your server.

Now you can push your modified Docker file to github. 

# Make your docker shiny server image accessible through docker hub

To do so, you will need to link your github and dockerhub accounts. To do so, simply follow the instructions provided in [this post](https://felixcentmerino.wordpress.com/containers/sync-up-docker-hub-and-github-to-build-images-automatically/)

# installing the docker shiny server image on a server 

Once docker hub shows that the build is ready, on the host server enter the folowing command :

```bash
$ sudo docker pull <USERNAME/IMAGENAME>
```
The shiny server image is now available in your server. But we need one more step ! As the shinyapps are only available as packages, we need some extra lines of R code to actually initiate the shiny apps. On the host server, create a folder which contains your R scripts that instantiate the shiny app. Example R script : 

```r
dir <- system.file("shiny", "reporting", package = "defHydWal")
setwd(dir)
shiny::shinyAppDir(".")
```



# instantiate at an open port in detached mode
```bash
sudo docker run -d --rm -p 3838:3838     -v /home/tgoossens/Documents/code/agrometeor/shiny-1/mountpoints/:/srv/shiny-server/     -v /srv/shinylog/:/var/log/shiny-server/     pokyah/shinyagro
```

for mounting the token : https://stackoverflow.com/questions/18861834/mounting-multiple-volumes-on-a-docker-container